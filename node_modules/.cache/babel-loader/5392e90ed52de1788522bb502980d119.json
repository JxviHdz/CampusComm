{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Hernandez\\\\Documents\\\\DOCUMENTOS UNIVERSIDAD\\\\INGENIERIA DE SOFTWARE\\\\CampusComm\\\\src\\\\EditProfile.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Avatar, Box, Button, CardContent, Grid, Paper, TextField } from \"@material-ui/core\";\nimport { useStyles } from \"./authentication/Menu\";\nimport BrandLogo from \"./BrandLogo\";\nimport { Autocomplete } from \"@material-ui/lab\";\nimport firebaseConfig, { auth, storage } from \"./firebase\";\nimport firebase from \"firebase\";\nimport { Redirect } from \"react-router-dom\";\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport { useCollectionData, useCollection } from 'react-firebase-hooks/firestore';\nimport { useHistory } from \"react-router-dom\";\nimport { FirstPageRounded, FormatLineSpacing } from '@material-ui/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst firestore = firebase.firestore();\n\nfunction EditProfile() {\n  _s();\n\n  const history = useHistory();\n  const classes = useStyles();\n  const [emptyValues, setEmptyValues] = useState({\n    firstName: false,\n    lastName: false,\n    email: false,\n    university: false\n  });\n  const [user] = useAuthState(auth);\n  var first = \"\",\n      last = \"\",\n      mail = user.email,\n      uni = \"\",\n      url = \"\",\n      pp = \"\";\n  var id = user.uid;\n  var [userData, loading] = useCollectionData(firestore.collection(\"users\").where(\"ID\", \"==\", id));\n  var chattingWith = [];\n\n  if (!loading) {\n    first = userData[0].Name;\n    last = userData[0].LastName;\n    mail = user.email;\n    uni = userData[0].University;\n    url = userData[0].photoURL;\n    chattingWith = userData[0].chattingWith;\n    pp = userData[0].profilePicture;\n  }\n\n  const [values, setValues] = useState({\n    firstName: first,\n    lastName: last,\n    email: mail,\n    university: uni\n  });\n\n  const handleChange = prop => event => {\n    setValues({ ...values,\n      [prop]: event.target.value\n    });\n  };\n\n  const handleChangeUni = prop => event => {\n    setValues({ ...values,\n      [prop]: event.target.innerHTML\n    });\n  };\n\n  const getImageName = url => {\n    let baseUrl = 'https://firebasestorage.googleapis.com/v0/b/ipproject-27ae8.appspot.com/o/images%2F';\n    let imageName = url.replace(baseUrl, '');\n    let indexOfEnd = imageName.indexOf('?');\n    imageName = imageName.substring(0, indexOfEnd);\n    return imageName;\n  };\n\n  const [currentUser, setCurrentUser] = useState(null);\n  var [listings, loading2] = useCollection(firestore.collection(\"listings\").where(\"seller\", \"==\", id));\n  var [reviews1, loading3] = useCollection(firestore.collection(\"reviewsForBuyers\").where(\"senderID\", \"==\", id));\n  var [reviews2, loading4] = useCollection(firestore.collection(\"reviewsForSellers\").where(\"senderID\", \"==\", id));\n  var [msg, loading5] = useCollection(firestore.collection(\"users/\" + id + \"/chats\"));\n\n  const handleDelete = async () => {\n    // Should first delete all that has to do with this user ID\n    // First delete their listings + images\n    if (!loading2 && listings) {\n      listings.forEach(listing => {\n        var imgName = getImageName(listing.data().imgUrl);\n        let storageRef = storage.ref('images').child(imgName);\n        storageRef.delete();\n        firestore.collection(\"listings\").doc(listing.id).delete();\n      });\n    } // in reviews for buyers and sellers (replace sellerID with \"\" where sellerID == user.id)\n\n\n    if (!loading3 && reviews1) {\n      reviews1.forEach(review => {\n        let revRef = firestore.collection(\"reviewsForBuyers\").doc(review.id);\n        revRef.update({\n          senderID: \"\"\n        });\n      });\n    }\n\n    if (!loading4 && reviews2) {\n      reviews2.forEach(review => {\n        let revRef = firestore.collection(\"reviewsForSellers\").doc(review.id);\n        revRef.update({\n          senderID: \"\"\n        });\n      });\n    } // delete the chats with all the other users\n\n\n    if (!loading5 && chattingWith) {\n      chattingWith.forEach(usr => {\n        firestore.collection(\"users/\" + usr + \"/chats\").where(\"SenderID\", \"==\", id).get().then(snapshot => {\n          snapshot.forEach(doc => {\n            doc.ref.delete();\n          });\n        });\n        firestore.collection(\"users/\" + usr + \"/chats\").where(\"ReceiverID\", \"==\", id).get().then(snapshot => {\n          snapshot.forEach(doc => {\n            doc.ref.delete();\n          });\n        });\n        firestore.collection(\"users\").where(\"ID\", \"==\", usr).get().then(snapshot => {\n          snapshot.forEach(doc => {\n            var oldVal = doc.data().chattingWith;\n            var index = oldVal.indexOf(id);\n            oldVal.splice(index, 1);\n            doc.ref.update({\n              chattingWith: oldVal\n            });\n          });\n        });\n      }); // deleting my chats\n\n      msg && msg.forEach(message => {\n        message.ref.delete();\n      });\n    } // delete my profile\n\n\n    firestore.collection(\"users\").doc(user.uid).delete().then();\n    user.delete().then(history.push(\"/menu\"));\n  };\n\n  const areYouSure = () => {\n    if (window.confirm('¿Estás seguro de que quieres eliminar tu perfil?')) {\n      handleDelete();\n    } else {\n      // Do nothing!\n      return;\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: loading ? /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Loading data\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      style: {\n        margin: 30\n      },\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        variant: \"contained\",\n        children: /*#__PURE__*/_jsxDEV(Paper, {\n          style: {\n            margin: \"auto\"\n          },\n          children: [\" \", /*#__PURE__*/_jsxDEV(Box, {\n            p: 3,\n            children: [/*#__PURE__*/_jsxDEV(Avatar, {\n              src: pp,\n              className: classes.profilePicture,\n              alt: \"Profile Image\",\n              children: first ? first.charAt(0).toUpperCase() : \"?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 3,\n              children: [/*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                children: /*#__PURE__*/_jsxDEV(TextField, {\n                  disabled: true,\n                  error: emptyValues.firstName,\n                  fullWidth: true,\n                  required: true,\n                  value: first,\n                  id: \"First-Name\",\n                  label: \"First Name\",\n                  variant: \"outlined\",\n                  color: \"primary\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 158,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 157,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                children: /*#__PURE__*/_jsxDEV(TextField, {\n                  disabled: true,\n                  error: emptyValues.lastName,\n                  fullWidth: true,\n                  required: true,\n                  value: last,\n                  id: \"Last-Name\",\n                  label: \"Last Name\",\n                  variant: \"outlined\",\n                  color: \"primary\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 171,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 170,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(TextField, {\n              disabled: true,\n              error: emptyValues.email,\n              fullWidth: true,\n              required: true,\n              value: values.email,\n              id: \"Email\",\n              label: \"Academic Email Address\",\n              variant: \"outlined\",\n              color: \"primary\",\n              style: {\n                marginTop: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(TextField, {\n              disabled: true,\n              fullWidth: true,\n              required: true,\n              value: uni,\n              id: \"University\",\n              label: \"University\",\n              variant: \"outlined\",\n              color: \"primary\",\n              style: {\n                marginTop: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              color: \"primary\",\n              style: {\n                marginTop: 10\n              },\n              onClick: () => {\n                areYouSure();\n              },\n              children: \"Delete Profile\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 207,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              color: \"primary\",\n              style: {\n                marginTop: 10\n              },\n              onClick: () => {\n                history.push(\"/ResetPassword\");\n              },\n              children: \"Reset Password\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 215,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 9\n  }, this);\n}\n\n_s(EditProfile, \"GzZEL/yuV7eU53lJpxooCi5j3S4=\", false, function () {\n  return [useHistory, useStyles, useAuthState, useCollectionData, useCollection, useCollection, useCollection, useCollection];\n});\n\n_c = EditProfile;\nexport default EditProfile;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditProfile\");","map":{"version":3,"sources":["C:/Users/Hernandez/Documents/DOCUMENTOS UNIVERSIDAD/INGENIERIA DE SOFTWARE/CampusComm/src/EditProfile.js"],"names":["React","useState","Avatar","Box","Button","CardContent","Grid","Paper","TextField","useStyles","BrandLogo","Autocomplete","firebaseConfig","auth","storage","firebase","Redirect","useAuthState","useCollectionData","useCollection","useHistory","FirstPageRounded","FormatLineSpacing","firestore","EditProfile","history","classes","emptyValues","setEmptyValues","firstName","lastName","email","university","user","first","last","mail","uni","url","pp","id","uid","userData","loading","collection","where","chattingWith","Name","LastName","University","photoURL","profilePicture","values","setValues","handleChange","prop","event","target","value","handleChangeUni","innerHTML","getImageName","baseUrl","imageName","replace","indexOfEnd","indexOf","substring","currentUser","setCurrentUser","listings","loading2","reviews1","loading3","reviews2","loading4","msg","loading5","handleDelete","forEach","listing","imgName","data","imgUrl","storageRef","ref","child","delete","doc","review","revRef","update","senderID","usr","get","then","snapshot","oldVal","index","splice","message","push","areYouSure","window","confirm","margin","charAt","toUpperCase","marginTop"],"mappings":"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","sourcesContent":["import React, {useState} from 'react';\nimport {Avatar, Box, Button, CardContent, Grid, Paper, TextField} from \"@material-ui/core\";\nimport {useStyles} from \"./authentication/Menu\";\nimport BrandLogo from \"./BrandLogo\";\nimport {Autocomplete} from \"@material-ui/lab\";\nimport firebaseConfig, {auth, storage} from \"./firebase\";\nimport firebase from \"firebase\";\nimport {Redirect} from \"react-router-dom\";\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport {useCollectionData, useCollection} from 'react-firebase-hooks/firestore';\nimport {useHistory} from \"react-router-dom\";\nimport { FirstPageRounded, FormatLineSpacing } from '@material-ui/icons';\n\nconst firestore = firebase.firestore();\n\nfunction EditProfile() {\n\n    const history = useHistory();\n    const classes = useStyles()\n\n    const [emptyValues, setEmptyValues] = useState({\n        firstName: false,\n        lastName: false,\n        email: false,\n        university: false,\n    })\n\n    const [user] = useAuthState(auth);\n    var first=\"\", last=\"\", mail=user.email, uni=\"\", url = \"\", pp=\"\";\n    var id = user.uid;\n    var [userData, loading] = useCollectionData(firestore.collection(\"users\").where(\"ID\", \"==\", id));\n    var chattingWith = [];\n    if(!loading){\n        first = userData[0].Name;\n        last = userData[0].LastName;\n        mail = user.email;\n        uni = userData[0].University;\n        url = userData[0].photoURL;\n        chattingWith = userData[0].chattingWith;\n        pp = userData[0].profilePicture\n    }\n\n    const [values, setValues] = useState({\n        firstName: first,\n        lastName: last,\n        email: mail,\n        university: uni,\n    })\n\n    const handleChange = (prop) => (event) => {\n        setValues({...values, [prop]: event.target.value});\n    }\n\n    const handleChangeUni = (prop) => (event) => {\n        setValues({...values, [prop]: event.target.innerHTML});\n    }\n\n    const getImageName = (url) => {\n        let baseUrl = 'https://firebasestorage.googleapis.com/v0/b/ipproject-27ae8.appspot.com/o/images%2F';\n        let imageName = url.replace(baseUrl, '');\n        let indexOfEnd = imageName.indexOf('?');\n        imageName = imageName.substring(0, indexOfEnd);\n        return imageName\n    }\n\n    const [currentUser, setCurrentUser] = useState(null);\n    var [listings, loading2] = useCollection(firestore.collection(\"listings\").where(\"seller\",\"==\",id));\n    var [reviews1, loading3] = useCollection(firestore.collection(\"reviewsForBuyers\").where(\"senderID\",\"==\",id));\n    var [reviews2, loading4] = useCollection(firestore.collection(\"reviewsForSellers\").where(\"senderID\",\"==\",id));\n    var [msg, loading5] = useCollection(firestore.collection(\"users/\" + id + \"/chats\"));\n\n    const handleDelete = async () => {\n        // Should first delete all that has to do with this user ID\n        // First delete their listings + images\n        if(!loading2 && listings){\n            listings.forEach(listing => {\n                var imgName = getImageName(listing.data().imgUrl);\n                let storageRef = storage.ref('images').child(imgName);\n                storageRef.delete();\n                firestore.collection(\"listings\").doc(listing.id).delete();\n            });\n        }\n        // in reviews for buyers and sellers (replace sellerID with \"\" where sellerID == user.id)\n        if(!loading3 && reviews1){\n            reviews1.forEach(review => {\n                let revRef = firestore.collection(\"reviewsForBuyers\").doc(review.id);\n                revRef.update({\n                    senderID: \"\"\n                })\n            })\n        }\n        if(!loading4 && reviews2){\n            reviews2.forEach(review => {\n                let revRef = firestore.collection(\"reviewsForSellers\").doc(review.id);\n                revRef.update({\n                    senderID: \"\"\n                })\n            })\n        }\n        // delete the chats with all the other users\n        if(!loading5 && chattingWith){\n            chattingWith.forEach(usr => {\n                firestore.collection(\"users/\" + usr + \"/chats\").where(\"SenderID\",\"==\",id).get().then(snapshot => {\n                    snapshot.forEach(doc => {\n                        doc.ref.delete();\n                    })\n                })\n                firestore.collection(\"users/\" + usr + \"/chats\").where(\"ReceiverID\",\"==\",id).get().then(snapshot => {\n                    snapshot.forEach(doc => {\n                        doc.ref.delete();\n                    })\n                })\n                firestore.collection(\"users\").where(\"ID\",\"==\",usr).get().then(snapshot => {\n                    snapshot.forEach(doc => {\n                        var oldVal = doc.data().chattingWith;\n                        var index = oldVal.indexOf(id)\n                        oldVal.splice(index, 1);\n                        doc.ref.update({\n                            chattingWith: oldVal\n                        }) \n                    })\n                })\n            })\n            // deleting my chats\n            msg && msg.forEach(message => {\n                message.ref.delete();\n            })\n        }\n        // delete my profile\n        firestore.collection(\"users\").doc(user.uid).delete().then();\n        user.delete().then(history.push(\"/menu\"));\n    };\n\n\n    const areYouSure = () => {\n        if (window.confirm('¿Estás seguro de que quieres eliminar tu perfil?')) {\n            handleDelete()\n        } else {\n            // Do nothing!\n            return\n        }\n    }\n\n    return (\n        <div>\n        {loading ?\n        <h1>Loading data</h1>\n        :\n        <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" style={{margin: 30}}>\n            <Grid container variant=\"contained\">\n                <Paper style={{margin: \"auto\"}}> {/*Need outline as we remove border in css*/}\n                    <Box p={3}>\n                        <Avatar src={pp} className={classes.profilePicture} alt=\"Profile Image\">\n                            {first ? first.charAt(0).toUpperCase() : \"?\"}\n                        </Avatar>\n                        <Grid container spacing={3}>\n                            <Grid item xs={6}>\n                                <TextField\n                                    disabled\n                                    error={emptyValues.firstName}\n                                    fullWidth\n                                    required\n                                    value={first}\n                                    id=\"First-Name\"\n                                    label=\"First Name\"\n                                    variant=\"outlined\"\n                                    color=\"primary\"\n                                />\n                            </Grid>\n                            <Grid item xs={6}>\n                                <TextField\n                                    disabled\n                                    error={emptyValues.lastName}\n                                    fullWidth\n                                    required\n                                    value={last}\n                                    id=\"Last-Name\"\n                                    label=\"Last Name\"\n                                    variant=\"outlined\"\n                                    color=\"primary\"\n                                />\n                            </Grid>\n                        </Grid>\n                        <TextField\n                            disabled\n                            error={emptyValues.email}\n                            fullWidth\n                            required\n                            value={values.email}\n                            id=\"Email\"\n                            label=\"Academic Email Address\"\n                            variant=\"outlined\"\n                            color=\"primary\"\n                            style={{marginTop: 10}}\n                        />\n                        <TextField\n                            disabled\n                            fullWidth\n                            required\n                            value={uni}\n                            id=\"University\"\n                            label=\"University\"\n                            variant=\"outlined\"\n                            color=\"primary\"\n                            style={{marginTop: 10}}\n                        />\n                        <Button variant=\"outlined\" color=\"primary\"\n                                style={{marginTop: 10}}\n                                onClick={() => {\n                                    areYouSure()\n                                }}\n                        >\n                            Delete Profile\n                        </Button>\n                        <Button variant=\"outlined\" color=\"primary\"\n                                style={{marginTop: 10}}\n                                onClick={() => {\n                                    history.push(\"/ResetPassword\");\n                                }}\n                        >\n                            Reset Password\n                        </Button>\n                    </Box>\n                </Paper>\n            </Grid>\n        </Box>\n        }\n    </div>\n    )\n}\n\nexport default EditProfile;"]},"metadata":{},"sourceType":"module"}