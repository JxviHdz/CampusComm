{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Hernandez\\\\Documents\\\\DOCUMENTOS UNIVERSIDAD\\\\INGENIERIA DE SOFTWARE\\\\CampusComm\\\\src\\\\ChatRoom.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$(),\n    _s4 = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport firebase, { auth } from './firebase';\nimport { useCollection } from 'react-firebase-hooks/firestore';\nimport './ChatRoom.css';\nimport { Avatar, Box, Divider, fade, Grid, IconButton, InputBase, makeStyles, Paper, Typography } from \"@material-ui/core\";\nimport deepOrange from \"@material-ui/core/colors/deepOrange\";\nimport pink from \"@material-ui/core/colors/pink\";\nimport blue from \"@material-ui/core/colors/blue\";\nimport red from \"@material-ui/core/colors/red\";\nimport green from \"@material-ui/core/colors/green\";\nimport yellow from \"@material-ui/core/colors/yellow\";\nimport { useHistory } from \"react-router-dom\";\nimport Skeleton from \"@material-ui/lab/Skeleton\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { Send } from \"@material-ui/icons\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst firestore = firebase.firestore();\nvar myID, target, targetID, senderIDDB, receiverIDDB, targetName, interestedProduct, pp;\nvar oldText = \"\";\nvar chatWindow = document.getElementById(\"chat-window\");\nconst useStyles = makeStyles(theme => ({\n  table: {\n    minWidth: 650\n  },\n  headBG: {\n    backgroundColor: '#e0e0e0'\n  },\n  borderRight500: {\n    borderRight: '1px solid #e0e0e0'\n  },\n  messageArea: {\n    height: '65vh',\n    overflowY: 'auto'\n  },\n  profilePicture: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    margin: \"10px\",\n    border: \"0px solid black\",\n    width: \"50px\",\n    height: \"50px\",\n    '&:hover': {\n      cursor: \"pointer\"\n    }\n  },\n  miniTriangleYou: {\n    width: 0,\n    height: 0,\n    borderBottom: `5px solid ${theme.palette.secondary.main}`,\n    borderRight: \"5px solid transparent\"\n  },\n  miniTriangleThem: {\n    width: 0,\n    height: 0,\n    color: theme.palette.background.paper2,\n    borderBottom: `5px solid ${theme.palette.background.paper2}`,\n    borderLeft: \"5px solid transparent\"\n  },\n  bubbleYou: {\n    maxWidth: \"750px\",\n    backgroundColor: theme.palette.secondary.main,\n    border: `0.5px solid ${theme.palette.secondary.main}`,\n    padding: \"10px\"\n  },\n  bubbleThem: {\n    maxWidth: \"750px\",\n    backgroundColor: theme.palette.background.paper2,\n    border: `0.5px solid ${theme.palette.background.paper2}`,\n    padding: \"10px\"\n  },\n  profileBox: {\n    '&:hover': {\n      cursor: \"pointer\"\n    }\n  },\n  chatWindow: {\n    maxHeight: \"69vh\",\n    overflow: 'auto'\n  },\n  input: {\n    marginLeft: theme.spacing(1),\n    flex: 1,\n    border: \"0.5px solid black\"\n  },\n  iconButton: {\n    padding: 10\n  },\n  search: {\n    width: '100%',\n    height: \"39px\",\n    borderRadius: \"66px\",\n    backgroundColor: fade(theme.palette.common.white, 0.15),\n    '&:hover': {\n      backgroundColor: fade(theme.palette.common.white, 0.25)\n    }\n  },\n  searchIcon: {\n    padding: theme.spacing(0, 2),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  inputRoot: {\n    color: 'inherit'\n  },\n  inputInput: {\n    padding: theme.spacing(1, 1, 1, 0),\n    // vertical padding + font size from searchIcon\n    paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n    transition: theme.transitions.create('width'),\n    width: '100%'\n  },\n  sendButton: {\n    width: \"31px\",\n    height: \"31px\",\n    borderRadius: \"50%\",\n    marginRight: \"6px\",\n    backgroundColor: theme.palette.primary.main\n  }\n}));\n\nfunction ChatRoom(props) {\n  _s();\n\n  myID = props.location.state.myUID;\n  target = props.location.state.targetUserName;\n  targetID = props.location.state.targetUserID;\n  interestedProduct = props.location.state.interestedProduct;\n  var [me, loading] = useCollection(firestore.collection('users').where(\"ID\", \"==\", myID));\n  var chatNo;\n  chatWindow = document.getElementById(\"chat-window\");\n\n  if (chatWindow) {\n    chatWindow.scrollBottom = chatWindow.scrollHeight;\n  }\n\n  const colours = [deepOrange[500], pink[400], blue[300], red[500], green[500], yellow[500]];\n\n  function randomChoice(arr) {\n    return arr[Math.floor(arr.length * Math.random())];\n  }\n\n  const avatarColour = randomChoice(colours);\n  const classes = useStyles();\n  const history = useHistory();\n\n  if (!loading) {\n    firestore.collection(\"users\").doc(myID).update({\n      chattingWith: firebase.firestore.FieldValue.arrayUnion(targetID)\n    });\n    firestore.collection(\"users\").doc(targetID).update({\n      chattingWith: firebase.firestore.FieldValue.arrayUnion(myID)\n    });\n    me.forEach(me => {\n      chatNo = me.data().chatsNo;\n\n      if (chatNo == 0) {\n        chatNo += 1; // we create our first chat\n      }\n\n      senderIDDB = me.id;\n    });\n  } // need to get an instance of the user, for this I need the ID though, not their name\n\n\n  var [receiver, loadingRe] = useCollection(firestore.collection('users').where(\"ID\", \"==\", targetID));\n\n  if (!loadingRe) {\n    receiver.forEach(receiver => {\n      receiverIDDB = receiver.id;\n      targetName = receiver.data().Name;\n      pp = receiver.data().profilePicture;\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Box, {\n      p: 3,\n      children: /*#__PURE__*/_jsxDEV(Paper, {\n        style: {\n          paddingBottom: \"10px\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: 1,\n          className: classes.profileBox,\n          onClick: () => {\n            history.push(\"/profile\", {\n              targetUserID: targetID,\n              currentUserID: myID\n            });\n          },\n          children: /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            alignItems: \"center\",\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              children: /*#__PURE__*/_jsxDEV(Avatar, {\n                src: pp,\n                className: classes.profilePicture,\n                alt: \"Profile Image\",\n                style: {\n                  backgroundColor: `${avatarColour}`\n                },\n                children: targetName ? targetName.charAt(0) : \"?\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 28\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 28\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 12,\n                children: /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h5\",\n                  style: {\n                    fontSize: \"24px\"\n                  },\n                  display: \"block\",\n                  children: targetName ? targetName.charAt(0).toUpperCase() + targetName.substr(1) : \"Username not found\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 210,\n                  columnNumber: 32\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 28\n              }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 12,\n                children: /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  style: {\n                    fontSize: \"18px\"\n                  },\n                  color: \"textSecondary\",\n                  display: \"block\",\n                  children: \"Click to view user's profile\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 215,\n                  columnNumber: 32\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 28\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 28\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 28\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 20\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          variant: \"middle\",\n          style: {\n            marginTop: \"10px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 20\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          className: classes.chatWindow,\n          children: /*#__PURE__*/_jsxDEV(Chatroom, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 24\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 20\n        }, this), /*#__PURE__*/_jsxDEV(Divider, {\n          variant: \"middle\",\n          style: {\n            marginTop: \"10px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 20\n        }, this), /*#__PURE__*/_jsxDEV(MessageBox, {\n          interestedProduct: interestedProduct\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 20\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 16\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 12\n    }, this)\n  }, void 0, false);\n}\n\n_s(ChatRoom, \"LuMopgtQsz6U9t1VxuUoOLesjrU=\", false, function () {\n  return [useCollection, useStyles, useHistory, useCollection];\n});\n\n_c = ChatRoom;\n\nfunction Chatroom() {\n  _s2();\n\n  const classes = useStyles();\n  const dummy = useRef();\n  const messagesRef1 = firestore.collection('users/' + senderIDDB + \"/chats\"); // me\n\n  const messagesRef2 = firestore.collection('users/' + receiverIDDB + \"/chats\"); // the other person\n\n  var [messages1, loading] = useCollection(messagesRef1.where(\"SenderID\", \"==\", targetID)); // I receive message\n\n  var [messages2, loading2] = useCollection(messagesRef1.where(\"ReceiverID\", \"==\", targetID)); // I send message\n\n  var messages = [];\n  var count = 0;\n\n  if (!loading && !loading2) {\n    messages1.forEach(msg => {\n      messages[count] = msg.data(); // console.log(msg.data());\n\n      var msgID = msg.id;\n      firestore.collection('users/' + senderIDDB + \"/chats\").doc(msgID).update({\n        seen: \"true\"\n      });\n      count++;\n    });\n    messages2.forEach(msg => {\n      messages[count] = msg.data(); //msg.seen = \"true\";\n\n      count++;\n    });\n    messages.sort((a, b) => a.createdAt > b.createdAt ? 1 : -1);\n  }\n\n  const [msgVal, setMsgVal] = useState(\"\");\n\n  function divideMessages(messageList) {\n    let out = [];\n    let temp = [];\n\n    for (let message of messageList) {\n      if (temp.length === 0 || temp[temp.length - 1].SenderID === message.SenderID) {\n        temp.push(message);\n      } else {\n        out.push(temp);\n        temp = [message];\n      }\n    }\n\n    out.push(temp);\n    return out;\n  }\n\n  useEffect(() => {\n    var _dummy$current;\n\n    (_dummy$current = dummy.current) === null || _dummy$current === void 0 ? void 0 : _dummy$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  });\n  const messagesDivided = divideMessages(messages);\n\n  function handleMsgClump(clump) {\n    let out = [];\n\n    for (const [index, msg] of clump.entries()) {\n      if (clump.length === 1) {\n        out.push( /*#__PURE__*/_jsxDEV(ChatMessage, {\n          message: msg,\n          createdAt: msg.createdAt,\n          lastMessage: true,\n          firstMessage: true\n        }, msg.createdAt, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 26\n        }, this));\n      } else if (index === 0) {\n        out.push( /*#__PURE__*/_jsxDEV(ChatMessage, {\n          message: msg,\n          createdAt: msg.createdAt,\n          lastMessage: false,\n          firstMessage: true\n        }, msg.createdAt, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 26\n        }, this));\n      } else if (index === clump.length - 1) {\n        out.push( /*#__PURE__*/_jsxDEV(ChatMessage, {\n          message: msg,\n          createdAt: msg.createdAt,\n          lastMessage: true,\n          firstMessage: false\n        }, msg.createdAt, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 26\n        }, this));\n      } else {\n        out.push( /*#__PURE__*/_jsxDEV(ChatMessage, {\n          message: msg,\n          createdAt: msg.createdAt,\n          lastMessage: false,\n          firstMessage: false\n        }, msg.createdAt, false, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 26\n        }, this));\n      }\n    }\n\n    return out;\n  } // console.log(messages)\n  // console.log(messagesDivided)\n  // const messagesEndRef = useRef(null)\n  //\n  // useEffect(() => {\n  //     messagesEndRef.current.scrollIntoView({\n  //         behavior: 'smooth',\n  //         block: 'end',\n  //         inline: 'nearest'\n  //     });\n  // });\n\n\n  return /*#__PURE__*/_jsxDEV(Box, {\n    p: 1,\n    style: {\n      width: \"100%\"\n    },\n    children: [messages && messagesDivided.map(msgs => handleMsgClump(msgs).map(msg => msg)), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: dummy\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 329,\n    columnNumber: 13\n  }, this);\n}\n\n_s2(Chatroom, \"a4YpUkNU2lp5EHDMZHnXY9NAgo0=\", false, function () {\n  return [useStyles, useCollection, useCollection];\n});\n\n_c2 = Chatroom;\n\nfunction MessageBox(props) {\n  _s3();\n\n  const classes = useStyles();\n  const [message, setMessage] = useState(\"\");\n  const [templateLoaded, setTemplateLoaded] = useState(false);\n  const messagesRef1 = firestore.collection('users/' + senderIDDB + \"/chats\"); // me\n\n  const messagesRef2 = firestore.collection('users/' + receiverIDDB + \"/chats\"); // the other person\n\n  const sendMessage = async e => {\n    if (message !== \"\") {\n      const {\n        uid,\n        photoURL\n      } = auth.currentUser;\n      await messagesRef1.add({\n        msg: message,\n        SenderID: uid,\n        ReceiverID: targetID,\n        createdAt: firebase.firestore.FieldValue.serverTimestamp(),\n        seen: \"true\"\n      }).then(docRef => {\n        console.log(\"Document written\");\n      }).catch(error => {\n        console.error(\"Error adding document: \", error);\n      });\n      await messagesRef2.add({\n        msg: message,\n        SenderID: uid,\n        ReceiverID: targetID,\n        createdAt: firebase.firestore.FieldValue.serverTimestamp(),\n        seen: \"false\"\n      }).then(docRef => {\n        console.log(\"Document written\");\n      }).catch(error => {\n        console.error(\"Error adding document: \", error);\n      });\n      setMessage(\"\");\n\n      if (chatWindow) {\n        chatWindow.scrollTop = chatWindow.scrollHeight; //dummy.scrollIntoView({behavior: \"smooth\"});\n      }\n    }\n  };\n\n  const onKeyPress = event => {\n    // console.log(`Pressed keyCode ${event.key}`);\n    if (event.key === 'Enter') {\n      sendMessage();\n    }\n  };\n\n  const handleChange = event => {\n    setMessage(event.target.value);\n  };\n\n  if (props.interestedProduct && message === \"\" && !templateLoaded) {\n    setMessage(\"Hi, im interested in: \" + props.interestedProduct + \". Is it still available\");\n    setTemplateLoaded(true);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Box, {\n    p: 1,\n    style: {\n      marginBottom: \"-8px\"\n    },\n    display: \"flex\",\n    children: /*#__PURE__*/_jsxDEV(Box, {\n      className: classes.search,\n      display: \"flex\",\n      justifyContent: \"flex-end\",\n      alignItems: \"center\",\n      children: [/*#__PURE__*/_jsxDEV(InputBase, {\n        fullWidth: true,\n        style: {\n          marginLeft: \"15px\",\n          marginRight: \"2px\"\n        },\n        placeholder: \"Type A Message\",\n        value: message,\n        onChange: handleChange,\n        onKeyPress: onKeyPress\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        className: classes.sendButton,\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        children: /*#__PURE__*/_jsxDEV(IconButton, {\n          onClick: () => {\n            sendMessage();\n          },\n          children: /*#__PURE__*/_jsxDEV(Send, {\n            style: {\n              fontSize: \"18px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 421,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 407,\n    columnNumber: 9\n  }, this);\n}\n\n_s3(MessageBox, \"x08at6F2u/BIrhEI0OFK9p0ndVo=\", false, function () {\n  return [useStyles];\n});\n\n_c3 = MessageBox;\n\nfunction ChatMessage(props) {\n  _s4();\n\n  const {\n    msg,\n    SenderID\n  } = props.message;\n  const classes = useStyles();\n  const [showTime, setShowTime] = useState(false);\n  let date = new Date(1970, 0, 1);\n\n  if (props.createdAt) {\n    date.setSeconds(props.createdAt.seconds);\n  }\n\n  let shortDate = date.getDate() + \"/\" + (date.getMonth() + 1) + \"/\" + date.getFullYear().toString().substr(2) + \" \" + date.getHours() + \":\" + date.getMinutes(); // console.log(msg + shortDate)\n  //console.log(myID)\n  //var text = \"\";\n  //var result = \"\";\n  //if(SenderID == myID) {text = \"You\"}\n  //else{\n  //   text = targetName;\n  //}\n  //console.log(text, oldText);\n  //if(text == oldText && oldText != \"\") result = \"\";\n  //else {\n  //  result = text + \":\";\n  //  oldText = text;\n  //}\n  //const messageClass = uid === auth.currentUser.uid ? 'sent' : 'received';\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: SenderID === myID ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          className: classes.bubbleYou,\n          style: {\n            borderRadius: `10px ${props.firstMessage ? \"10px\" : \"0\"} 0 10px`,\n            marginTop: `${props.firstMessage ? \"15px\" : \"2px\"}`,\n            marginRight: `${props.lastMessage ? \"0px\" : \"5px\"}`\n          },\n          onClick: () => {\n            setShowTime(!showTime);\n          },\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body1\",\n            color: \"textPrimary\",\n            children: msg\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"flex-end\",\n          onClick: () => {\n            setShowTime(!showTime);\n          },\n          children: props.lastMessage ? /*#__PURE__*/_jsxDEV(Box, {\n            className: classes.miniTriangleYou\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 475,\n            columnNumber: 50\n          }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 474,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 21\n      }, this), showTime ? /*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"body2\",\n          children: shortDate\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 33\n      }, this) : \"\"]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-start\",\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"flex-end\",\n          onClick: () => {\n            setShowTime(!showTime);\n          },\n          children: props.lastMessage ? /*#__PURE__*/_jsxDEV(Box, {\n            className: classes.miniTriangleThem\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          children: /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            className: classes.bubbleThem,\n            style: {\n              borderRadius: `${props.firstMessage ? \"10px\" : \"0\"} 10px 10px 0`,\n              marginTop: `${props.firstMessage ? \"15px\" : \"2px\"}`,\n              marginLeft: `${props.lastMessage ? \"0px\" : \"5px\"}`\n            },\n            onClick: () => {\n              setShowTime(!showTime);\n            },\n            children: /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body1\",\n              color: \"textPrimary\",\n              children: msg\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 500,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 493,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 21\n      }, this), showTime ? /*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-start\",\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"body2\",\n          children: shortDate\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 506,\n        columnNumber: 33\n      }, this) : \"\"]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 462,\n    columnNumber: 9\n  }, this);\n}\n\n_s4(ChatMessage, \"5XmCO0dw14jikti0GsUbe/cDucM=\", false, function () {\n  return [useStyles];\n});\n\n_c4 = ChatMessage;\nexport default ChatRoom;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"ChatRoom\");\n$RefreshReg$(_c2, \"Chatroom\");\n$RefreshReg$(_c3, \"MessageBox\");\n$RefreshReg$(_c4, \"ChatMessage\");","map":{"version":3,"sources":["C:/Users/Hernandez/Documents/DOCUMENTOS UNIVERSIDAD/INGENIERIA DE SOFTWARE/CampusComm/src/ChatRoom.js"],"names":["React","useEffect","useRef","useState","firebase","auth","useCollection","Avatar","Box","Divider","fade","Grid","IconButton","InputBase","makeStyles","Paper","Typography","deepOrange","pink","blue","red","green","yellow","useHistory","Skeleton","SearchIcon","Send","firestore","myID","target","targetID","senderIDDB","receiverIDDB","targetName","interestedProduct","pp","oldText","chatWindow","document","getElementById","useStyles","theme","table","minWidth","headBG","backgroundColor","borderRight500","borderRight","messageArea","height","overflowY","profilePicture","display","justifyContent","margin","border","width","cursor","miniTriangleYou","borderBottom","palette","secondary","main","miniTriangleThem","color","background","paper2","borderLeft","bubbleYou","maxWidth","padding","bubbleThem","profileBox","maxHeight","overflow","input","marginLeft","spacing","flex","iconButton","search","borderRadius","common","white","searchIcon","position","pointerEvents","alignItems","inputRoot","inputInput","paddingLeft","transition","transitions","create","sendButton","marginRight","primary","ChatRoom","props","location","state","myUID","targetUserName","targetUserID","me","loading","collection","where","chatNo","scrollBottom","scrollHeight","colours","randomChoice","arr","Math","floor","length","random","avatarColour","classes","history","doc","update","chattingWith","FieldValue","arrayUnion","forEach","data","chatsNo","id","receiver","loadingRe","Name","paddingBottom","push","currentUserID","charAt","fontSize","toUpperCase","substr","marginTop","Chatroom","dummy","messagesRef1","messagesRef2","messages1","messages2","loading2","messages","count","msg","msgID","seen","sort","a","b","createdAt","msgVal","setMsgVal","divideMessages","messageList","out","temp","message","SenderID","current","scrollIntoView","behavior","messagesDivided","handleMsgClump","clump","index","entries","map","msgs","MessageBox","setMessage","templateLoaded","setTemplateLoaded","sendMessage","e","uid","photoURL","currentUser","add","ReceiverID","serverTimestamp","then","docRef","console","log","catch","error","scrollTop","onKeyPress","event","key","handleChange","value","marginBottom","ChatMessage","showTime","setShowTime","date","Date","setSeconds","seconds","shortDate","getDate","getMonth","getFullYear","toString","getHours","getMinutes","firstMessage","lastMessage"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from 'react';\nimport firebase, {auth} from './firebase';\nimport {useCollection} from 'react-firebase-hooks/firestore';\nimport './ChatRoom.css';\nimport {\n    Avatar,\n    Box,\n    Divider,\n    fade,\n    Grid,\n    IconButton,\n    InputBase,\n    makeStyles,\n    Paper,\n    Typography\n} from \"@material-ui/core\";\nimport deepOrange from \"@material-ui/core/colors/deepOrange\";\nimport pink from \"@material-ui/core/colors/pink\";\nimport blue from \"@material-ui/core/colors/blue\";\nimport red from \"@material-ui/core/colors/red\";\nimport green from \"@material-ui/core/colors/green\";\nimport yellow from \"@material-ui/core/colors/yellow\";\nimport {useHistory} from \"react-router-dom\";\nimport Skeleton from \"@material-ui/lab/Skeleton\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport {Send} from \"@material-ui/icons\";\n\nconst firestore = firebase.firestore();\nvar myID, target, targetID, senderIDDB, receiverIDDB, targetName, interestedProduct, pp;\nvar oldText = \"\";\n\nvar chatWindow = document.getElementById(\"chat-window\");\n\nconst useStyles = makeStyles((theme) => ({\n    table: {\n        minWidth: 650,\n    },\n    headBG: {\n        backgroundColor: '#e0e0e0'\n    },\n    borderRight500: {\n        borderRight: '1px solid #e0e0e0'\n    },\n    messageArea: {\n        height: '65vh',\n        overflowY: 'auto'\n    },\n    profilePicture: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        margin: \"10px\",\n        border: \"0px solid black\",\n        width: \"50px\",\n        height: \"50px\",\n        '&:hover': {\n            cursor: \"pointer\",\n        }\n    },\n    miniTriangleYou: {\n        width: 0,\n        height: 0,\n        borderBottom: `5px solid ${theme.palette.secondary.main}`,\n        borderRight: \"5px solid transparent\",\n    },\n    miniTriangleThem: {\n        width: 0,\n        height: 0,\n        color: theme.palette.background.paper2,\n        borderBottom: `5px solid ${theme.palette.background.paper2}`,\n        borderLeft: \"5px solid transparent\",\n    },\n    bubbleYou: {\n        maxWidth: \"750px\",\n        backgroundColor: theme.palette.secondary.main,\n        border: `0.5px solid ${theme.palette.secondary.main}`,\n        padding: \"10px\",\n    },\n    bubbleThem: {\n        maxWidth: \"750px\",\n        backgroundColor: theme.palette.background.paper2,\n        border: `0.5px solid ${theme.palette.background.paper2}`,\n        padding: \"10px\",\n    },\n    profileBox: {\n        '&:hover': {\n            cursor: \"pointer\",\n        }\n    },\n    chatWindow: {\n        maxHeight: \"69vh\",\n        overflow: 'auto',\n    },\n    input: {\n        marginLeft: theme.spacing(1),\n        flex: 1,\n        border: \"0.5px solid black\",\n    },\n    iconButton: {\n        padding: 10,\n    },\n    search: {\n        width: '100%',\n        height: \"39px\",\n        borderRadius: \"66px\",\n        backgroundColor: fade(theme.palette.common.white, 0.15),\n        '&:hover': {\n            backgroundColor: fade(theme.palette.common.white, 0.25),\n        },\n    },\n    searchIcon: {\n        padding: theme.spacing(0, 2),\n        height: '100%',\n        position: 'absolute',\n        pointerEvents: 'none',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n    },\n    inputRoot: {\n        color: 'inherit',\n    },\n    inputInput: {\n        padding: theme.spacing(1, 1, 1, 0),\n        // vertical padding + font size from searchIcon\n        paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n        transition: theme.transitions.create('width'),\n        width: '100%',\n    },\n    sendButton: {\n        width: \"31px\",\n        height: \"31px\",\n        borderRadius: \"50%\",\n        marginRight: \"6px\",\n        backgroundColor: theme.palette.primary.main,\n}\n}));\n\nfunction ChatRoom(props) {\n    myID = props.location.state.myUID;\n    target = props.location.state.targetUserName;\n    targetID = props.location.state.targetUserID;\n    interestedProduct = props.location.state.interestedProduct\n    var [me, loading] = useCollection(firestore.collection('users').where(\"ID\", \"==\", myID));\n    var chatNo;\n\n    chatWindow = document.getElementById(\"chat-window\");\n    if (chatWindow) {\n        chatWindow.scrollBottom = chatWindow.scrollHeight;\n    }\n\n    const colours = [deepOrange[500], pink[400], blue[300], red[500], green[500], yellow[500]];\n\n    function randomChoice(arr) {\n        return arr[Math.floor(arr.length * Math.random())];\n    }\n\n    const avatarColour = randomChoice(colours);\n\n    const classes = useStyles();\n    const history = useHistory();\n\n    if (!loading) {\n        firestore.collection(\"users\").doc(myID).update({\n            chattingWith: firebase.firestore.FieldValue.arrayUnion(targetID),\n        })\n        firestore.collection(\"users\").doc(targetID).update({\n            chattingWith: firebase.firestore.FieldValue.arrayUnion(myID),\n        })\n        me.forEach(me => {\n            chatNo = me.data().chatsNo;\n            if (chatNo == 0) {\n                chatNo += 1; // we create our first chat\n            }\n            senderIDDB = me.id;\n        })\n    }\n\n\n    // need to get an instance of the user, for this I need the ID though, not their name\n    var [receiver, loadingRe] = useCollection(firestore.collection('users').where(\"ID\", \"==\", targetID));\n\n    if (!loadingRe) {\n        receiver.forEach(receiver => {\n            receiverIDDB = receiver.id;\n            targetName = receiver.data().Name;\n            pp = receiver.data().profilePicture\n        })\n    }\n\n    return (\n        <>\n           <Box p={3}>\n               <Paper style={{paddingBottom: \"10px\"}}>\n                   <Grid container spacing={1} className={classes.profileBox} onClick={() => {\n                       history.push(\"/profile\", {\n                           targetUserID: targetID,\n                           currentUserID: myID\n                       })\n                   }}>\n\n                           <Box display=\"flex\" alignItems=\"center\" >\n                           <Box>\n                           <Avatar src={pp} className={classes.profilePicture} alt=\"Profile Image\"\n                                   style={{backgroundColor: `${avatarColour}`}}>\n                               {targetName ? targetName.charAt(0) : \"?\"}\n                           </Avatar>\n                           </Box>\n                           <Box>\n                           <Grid item xs={12}>\n                               <Typography variant=\"h5\" style={{fontSize: \"24px\"}} display=\"block\">\n                                   {targetName ? targetName.charAt(0).toUpperCase() + targetName.substr(1) : \"Username not found\"}\n                               </Typography>\n                           </Grid>\n                           <Grid item xs={12}>\n                               <Typography variant=\"body2\" style={{fontSize: \"18px\"}} color=\"textSecondary\"\n                                           display=\"block\">\n                                   Click to view user's profile\n                               </Typography>\n                           </Grid>\n                           </Box>\n                           </Box>\n                   </Grid>\n                   <Divider variant=\"middle\" style={{marginTop: \"10px\"}}/>\n                   <Box display=\"flex\" className={classes.chatWindow}>\n                       <Chatroom/>\n                   </Box>\n                   <Divider variant=\"middle\" style={{marginTop: \"10px\"}}/>\n                   <MessageBox interestedProduct={interestedProduct}/>\n               </Paper>\n           </Box>\n        </>\n    )\n\n}\n\nfunction Chatroom() {\n    const classes = useStyles();\n    const dummy = useRef();\n\n    const messagesRef1 = firestore.collection('users/' + senderIDDB + \"/chats\"); // me\n    const messagesRef2 = firestore.collection('users/' + receiverIDDB + \"/chats\"); // the other person\n\n    var [messages1, loading] = useCollection(messagesRef1.where(\"SenderID\", \"==\", targetID)); // I receive message\n    var [messages2, loading2] = useCollection(messagesRef1.where(\"ReceiverID\", \"==\", targetID)); // I send message\n\n    var messages = [];\n    var count = 0;\n    if (!loading && !loading2) {\n        messages1.forEach(msg => {\n            messages[count] = msg.data();\n            // console.log(msg.data());\n            var msgID = msg.id;\n            firestore.collection('users/' + senderIDDB + \"/chats\").doc(msgID).update({\n                seen: \"true\"\n            })\n            count++;\n        })\n\n        messages2.forEach(msg => {\n            messages[count] = msg.data();\n            //msg.seen = \"true\";\n            count++;\n        })\n\n        messages.sort((a, b) => (a.createdAt > b.createdAt) ? 1 : -1);\n    }\n\n    const [msgVal, setMsgVal] = useState(\"\");\n\n    function divideMessages(messageList) {\n        let out = []\n        let temp = []\n        for (let message of messageList) {\n            if (temp.length === 0 || temp[temp.length - 1].SenderID === message.SenderID) {\n                temp.push(message);\n            } else {\n                out.push(temp);\n                temp = [message]\n            }\n        }\n        out.push(temp);\n        return out\n    }\n\n    \n    useEffect(() => {\n        dummy.current?.scrollIntoView({behavior: \"smooth\"});\n    });\n\n    const messagesDivided = divideMessages(messages);\n\n    function handleMsgClump(clump) {\n        let out = []\n        for (const [index, msg] of clump.entries()) {\n            if (clump.length === 1) {\n                out.push(<ChatMessage key={msg.createdAt} message={msg} createdAt={msg.createdAt} lastMessage={true}\n                                      firstMessage={true}/>)\n            } else if (index === 0) {\n                out.push(<ChatMessage key={msg.createdAt} message={msg} createdAt={msg.createdAt} lastMessage={false}\n                                      firstMessage={true}/>)\n            } else if (index === clump.length - 1) {\n                out.push(<ChatMessage key={msg.createdAt} message={msg} createdAt={msg.createdAt} lastMessage={true}\n                                      firstMessage={false}/>)\n            } else {\n                out.push(<ChatMessage key={msg.createdAt} message={msg} createdAt={msg.createdAt} lastMessage={false}\n                                      firstMessage={false}/>)\n            }\n        }\n        return out\n    }\n\n\n\n    // console.log(messages)\n    // console.log(messagesDivided)\n\n\n    // const messagesEndRef = useRef(null)\n    //\n    // useEffect(() => {\n    //     messagesEndRef.current.scrollIntoView({\n    //         behavior: 'smooth',\n    //         block: 'end',\n    //         inline: 'nearest'\n    //     });\n    // });\n\n    return (\n            <Box p={1} style={{width: \"100%\"}}>\n                {messages && messagesDivided.map(msgs => handleMsgClump(msgs).map(msg => msg))}\n                <div ref={dummy}/>\n            </Box>\n        )\n}\n\nfunction MessageBox(props) {\n    const classes = useStyles();\n\n    const [message, setMessage] = useState(\"\");\n    const [templateLoaded, setTemplateLoaded] = useState(false);\n\n    const messagesRef1 = firestore.collection('users/' + senderIDDB + \"/chats\"); // me\n    const messagesRef2 = firestore.collection('users/' + receiverIDDB + \"/chats\"); // the other person\n\n    const sendMessage = async (e) => {\n\n        if (message !== \"\") {\n\n            const {uid, photoURL} = auth.currentUser;\n\n            await messagesRef1.add({\n                msg: message,\n                SenderID: uid,\n                ReceiverID: targetID,\n                createdAt: firebase.firestore.FieldValue.serverTimestamp(),\n                seen: \"true\"\n            })\n                .then((docRef) => {\n                    console.log(\"Document written\");\n                })\n                .catch((error) => {\n                    console.error(\"Error adding document: \", error);\n                });\n\n            await messagesRef2.add({\n                msg: message,\n                SenderID: uid,\n                ReceiverID: targetID,\n                createdAt: firebase.firestore.FieldValue.serverTimestamp(),\n                seen: \"false\"\n            })\n                .then((docRef) => {\n                    console.log(\"Document written\");\n                })\n                .catch((error) => {\n                    console.error(\"Error adding document: \", error);\n                });\n\n            setMessage(\"\");\n\n            if (chatWindow) {\n                chatWindow.scrollTop = chatWindow.scrollHeight;\n                //dummy.scrollIntoView({behavior: \"smooth\"});\n            }\n        }\n\n\n    }\n\n    const onKeyPress = (event) => {\n        // console.log(`Pressed keyCode ${event.key}`);\n        if (event.key === 'Enter') {\n            sendMessage()\n        }\n    }\n\n    const handleChange = (event) => {\n        setMessage(event.target.value);\n    }\n\n    if (props.interestedProduct && message === \"\" && !templateLoaded) {\n        setMessage(\"Hi, im interested in: \" + props.interestedProduct + \". Is it still available\");\n        setTemplateLoaded(true);\n    }\n\n    return (\n        <Box p={1} style={{marginBottom: \"-8px\"}} display=\"flex\">\n\n            <Box className={classes.search} display=\"flex\" justifyContent=\"flex-end\" alignItems=\"center\">\n                <InputBase fullWidth style={{marginLeft: \"15px\", marginRight: \"2px\"}}\n                           placeholder=\"Type A Message\"\n                           value={message}\n                           onChange={handleChange}\n                           onKeyPress={onKeyPress}\n                />\n                            {/*<input type=\"text\" value={msgVal} onChange={(e) => setMsgVal(e.target.value)}></input>*/}\n\n\n                        <Box className={classes.sendButton} display=\"flex\" justifyContent=\"center\" alignItems=\"center\">\n                            <IconButton onClick={() => {sendMessage()}}>\n                                <Send style={{fontSize: \"18px\"}} />\n                            </IconButton>\n                </Box>\n            </Box>\n\n        </Box>\n    )\n}\n\nfunction ChatMessage(props) {\n    const {msg, SenderID} = props.message;\n    const classes = useStyles();\n    const [showTime, setShowTime] = useState(false)\n\n    let date = new Date(1970, 0, 1);\n\n    if (props.createdAt) {\n        date.setSeconds(props.createdAt.seconds);\n    }\n\n    let shortDate = date.getDate() + \"/\" + (date.getMonth() + 1) + \"/\" + date.getFullYear().toString().substr(2) + \" \" + date.getHours() + \":\" + date.getMinutes()\n\n    // console.log(msg + shortDate)\n\n    //console.log(myID)\n    //var text = \"\";\n    //var result = \"\";\n    //if(SenderID == myID) {text = \"You\"}\n    //else{\n\n    //   text = targetName;\n    //}\n    //console.log(text, oldText);\n    //if(text == oldText && oldText != \"\") result = \"\";\n    //else {\n    //  result = text + \":\";\n    //  oldText = text;\n    //}\n    //const messageClass = uid === auth.currentUser.uid ? 'sent' : 'received';\n\n    return (\n        <div>\n            {SenderID === myID ?\n                <>\n                    <Box display=\"flex\" justifyContent=\"flex-end\" >\n                        <Box className={classes.bubbleYou} style={{\n                            borderRadius: `10px ${props.firstMessage ? \"10px\" : \"0\"} 0 10px`,\n                            marginTop: `${props.firstMessage ? \"15px\" : \"2px\"}`,\n                            marginRight: `${props.lastMessage ? \"0px\" : \"5px\"}`,}\n                        } onClick={() => {setShowTime(!showTime)}}\n                        >\n                            <Typography variant=\"body1\" color=\"textPrimary\">{msg}</Typography>\n                        </Box>\n                        <Box display=\"flex\" alignItems=\"flex-end\" onClick={() => {setShowTime(!showTime)}}>\n                            {props.lastMessage ? <Box className={classes.miniTriangleYou}\n                            /> : <></>}\n                        </Box>\n                    </Box>\n                    {showTime ? <Box display=\"flex\" justifyContent=\"flex-end\">\n                        <Typography variant=\"body2\">\n                            {shortDate}\n                        </Typography>\n                    </Box> : \"\"}\n                </>\n                :\n                <>\n                    <Box display=\"flex\" justifyContent=\"flex-start\" >\n                        <Box display=\"flex\" alignItems=\"flex-end\" onClick={() => {setShowTime(!showTime)}}>\n                            {props.lastMessage ?\n                                <Box className={classes.miniTriangleThem}\n                            /> : <></>}\n                        </Box>\n                        <Box>\n                            <Box display=\"flex\" flexWrap=\"wrap\" className={classes.bubbleThem} style={{\n                                borderRadius: `${props.firstMessage ? \"10px\" : \"0\"} 10px 10px 0`,\n                                marginTop: `${props.firstMessage ? \"15px\" : \"2px\"}`,\n                                marginLeft: `${props.lastMessage ? \"0px\" : \"5px\"}`,\n                            }} onClick={() => {setShowTime(!showTime)}}\n                            >\n                                <Typography variant=\"body1\" color=\"textPrimary\">{msg}</Typography>\n                            </Box>\n\n                        </Box>\n                    </Box>\n\n                    {showTime ? <Box display=\"flex\" justifyContent=\"flex-start\">\n                        <Typography variant=\"body2\">\n                            {shortDate}\n                        </Typography>\n                    </Box> : \"\"}\n                </>\n            }\n        </div>\n    )\n}\n\n\nexport default ChatRoom;"]},"metadata":{},"sourceType":"module"}